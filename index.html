<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evair - Platforma Społecznościowa</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="background-decor">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
    </div>

    <header class="top-bar">
        <div class="top-bar-left">
            <button id="mobile-menu-btn" aria-label="Otwórz menu">
                <svg width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
            </button>
            
            <div class="logo-container">
                <img src="logo.png" alt="Evair Logo" class="logo-img"> 
            </div>

            <h1 id="page-title" class="page-title">Witaj!</h1>
        </div>

        <!-- NEW: Dropdown profilu użytkownika -->
        <div class="user-profile" id="user-profile-section">
            <!-- Admin User Management Button (small, next to profile) -->
            <button class="btn-admin-users-small" id="btn-admin-users" style="display: none;" aria-label="Zarządzanie użytkownikami" title="Zarządzanie użytkownikami">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </button>

            <button class="user-profile-btn" id="user-profile-btn" aria-label="Menu użytkownika">
                <span class="user-name" id="user-display-name">Gość</span>
                <div class="avatar" id="user-avatar">?</div>
            </button>
            <div class="user-dropdown" id="user-dropdown">
                <button class="dropdown-item" data-target="profile">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    Mój profil
                </button>
                <button class="dropdown-item" id="logout-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    Wyloguj się
                </button>
            </div>
        </div>
    </header>

    <div class="main-container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-content">
                
                <div class="nav-group">
                    <h3 class="nav-header" data-editable-id="category_info">Informacje</h3>
                    <ul>
                        <li>
                            <button class="nav-btn active" data-target="welcome">
                                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                                <span class="nav-text" data-editable-id="nav_welcome">Witaj!</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-btn" data-target="announcements">
                                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                                <span class="nav-text" data-editable-id="nav_announcements">Ogłoszenia</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-btn" data-target="events">
                                <svg class="nav-icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                                <span class="nav-text" data-editable-id="nav_events">Wydarzenia</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-btn" data-target="booking">
                                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                <span class="nav-text" data-editable-id="nav_booking">Kalendarz rezerwacji</span>
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="nav-group">
                    <h3 class="nav-header" data-editable-id="category_training">Szkolenia</h3>
                    <ul>
                        <li>
                            <button class="nav-btn" data-target="training">
                                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                                <span class="nav-text">Materiały szkoleniowe</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-btn disabled" disabled>
                                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                                Centrum Nauki
                                <span class="badge-soon">Wkrótce</span>
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="nav-group">
                    <h3 class="nav-header" data-editable-id="category_community">Społeczność</h3>
                    <ul>
                        <li>
                            <button class="nav-btn" data-target="feed">
                                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                <span class="nav-text">BlaBlaAir</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-btn" data-target="gallery">
                                <svg class="nav-icon" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                                <span class="nav-text">Galeria zdjęć</span>
                            </button>
                        </li>
                    </ul>
                </div>

                

            </div>
        </nav>

        <main id="content" class="content-area">

            <section id="welcome" class="channel-section active">
                <div class="card welcome-card">
                    <h2 data-editable-id="welcome_title">Witaj na platformie Evair!</h2>
                    <p class="intro-text" data-editable-id="welcome_intro">Cieszymy się, że jesteś z nami. Oto kilka prostych kroków na początek:</p>
                    <ul class="steps-list" data-editable-id="welcome_steps">
                        <li><strong>1.</strong> Uzupełnij swój profil (kliknij w swoje imię w prawym górnym rogu).</li>
                        <li><strong>2.</strong> Zapoznaj się z regulaminem (link w stopce strony).</li>
                        <li><strong>3.</strong> Rozpocznij rozmowy z innymi użytkownikami w sekcji „Evair - rozmowy".</li>
                    </ul>
                </div>
            </section>

            <section id="announcements" class="channel-section">
                <div class="section-header">
                    <h2 data-editable-id="announcements-title">Tablica ogłoszeń</h2>
                    <p class="subtitle" data-editable-id="announcements-subtitle">Tutaj znajdziesz komunikaty od administracji.</p>
                </div>

                <!-- Admin panel for creating announcements (visible only to admins) -->
                <div id="admin-announcement-creator" class="card announcement-creator-card" style="display: none;">
                    <h3 id="announcement-form-title">Dodaj ogłoszenie</h3>
                    <form id="create-announcement-form">
                        <input type="hidden" id="announcement-edit-id">
                        <div class="form-group">
                            <label for="announcement-title">Tytuł ogłoszenia</label>
                            <input type="text" id="announcement-title" class="input-field" placeholder="Tytuł..." required>
                        </div>
                        <div class="form-group">
                            <label for="announcement-content">Treść ogłoszenia</label>
                            <textarea id="announcement-content" class="input-field" rows="4" placeholder="Wpisz treść ogłoszenia..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="announcement-tag">Tag</label>
                            <select id="announcement-tag" class="input-field">
                                <option value="Ważne">Ważne</option>
                                <option value="Techniczne">Techniczne</option>
                                <option value="Informacja">Informacja</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="announcement-submit-btn">Opublikuj</button>
                            <button type="button" class="btn btn-outline" id="announcement-cancel-btn" style="display: none;">Anuluj</button>
                        </div>
                    </form>
                </div>

                <!-- Container for dynamically loaded announcements -->
                <div id="announcements-list">
                    <p class="loading-text">Ładowanie ogłoszeń...</p>
                </div>
            </section>

            <section id="events" class="channel-section">
                <div class="section-header">
                    <h2 data-editable-id="events_title">Nadchodzące wydarzenia</h2>
                    <p class="subtitle" data-editable-id="events_subtitle">Zapisz się, aby wziąć udział.</p>
                </div>

                <!-- Admin panel for creating events (visible only to admins) -->
                <div id="admin-event-creator" class="card event-creator-card" style="display: none;">
                    <h3>Dodaj wydarzenie</h3>
                    <form id="create-event-form">
                        <div class="form-group">
                            <label for="event-title">Tytuł wydarzenia</label>
                            <input type="text" id="event-title" class="input-field" placeholder="np. Warsztaty z nawigacji" required>
                        </div>
                        <div class="form-group">
                            <label for="event-date">Data i godzina</label>
                            <input type="datetime-local" id="event-date" class="input-field" required>
                        </div>
                        <div class="form-group">
                            <label for="event-description">Opis</label>
                            <textarea id="event-description" class="input-field" rows="3" placeholder="Opis wydarzenia..."></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Opublikuj wydarzenie</button>
                            <button type="button" id="cancel-edit-event" class="btn btn-outline" style="display: none;" onclick="cancelEditEvent()">Anuluj</button>
                        </div>
                    </form>
                </div>

                <!-- Container for dynamically loaded events -->
                <div id="events-list">
                    <p class="loading-text">Ładowanie wydarzeń...</p>
                </div>
            </section>

            <section id="booking" class="channel-section">
                <div class="card">
                    <h2 class="editable-text" data-text-id="calendar_title">System rezerwacji</h2>
                    <p class="subtitle editable-text" data-text-id="calendar_subtitle">Poniżej znajduje się kalendarz. Kliknij w wolny termin, aby zarezerwować.</p>

                    <div class="editable-html" data-text-id="calendar_embed_code">
                        <div class="iframe-placeholder big-placeholder">
                            <p>Tutaj będzie osadzony kalendarz rezerwacji (iframe)</p>
                        </div>
                    </div>
                </div>
            </section>


            <!-- PRYWATNY MESSENGER - Evair rozmowy (lewy dolny róg) -->
            

            <!-- BLA_BLA_AIR POST FEED - Społeczność -->
            <section id="feed" class="channel-section">
                <!-- Sekcja tworzenia posta -->
                <div class="create-post card">
                    <h3>O czym chcesz napisać?</h3>
                    <form id="create-post-form">
                        <textarea id="post-content-input" class="form-input" placeholder="Podziel się czymś ze społecznością..." required></textarea>

                        <!-- NEW: Przyciski załączników -->
                        <div class="post-attachments-buttons">
                            <button type="button" id="add-image-btn" class="btn-attachment" title="Dodaj zdjęcie">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21 15 16 10 5 21"></polyline>
                                </svg>
                                Zdjęcie
                            </button>
                            <button type="button" id="add-gif-btn" class="btn-attachment" title="Dodaj GIF">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>
                                    <line x1="7" y1="2" x2="7" y2="22"></line>
                                    <line x1="17" y1="2" x2="17" y2="22"></line>
                                    <line x1="2" y1="12" x2="22" y2="12"></line>
                                    <line x1="2" y1="7" x2="7" y2="7"></line>
                                    <line x1="2" y1="17" x2="7" y2="17"></line>
                                    <line x1="17" y1="17" x2="22" y2="17"></line>
                                    <line x1="17" y1="7" x2="22" y2="7"></line>
                                </svg>
                                GIF
                            </button>
                            <button type="button" id="add-video-btn" class="btn-attachment" title="Dodaj film">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                    <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                                </svg>
                                Film
                            </button>
                        </div>

                        <!-- Hidden file inputs -->
                        <input type="file" id="attachment-image-input" accept="image/*" multiple style="display: none;">
                        <input type="file" id="attachment-gif-input" accept="image/gif" multiple style="display: none;">
                        <input type="file" id="attachment-video-input" accept="video/*" multiple style="display: none;">

                        <!-- NEW: Podgląd załączników -->
                        <div id="attachments-preview" class="attachments-preview"></div>

                        <button type="submit" class="btn btn-primary">Opublikuj</button>
                    </form>
                </div>

                <!-- Lista postów -->
                <div id="feed-list">
                    <!-- Posty będą tutaj renderowane dynamicznie przez app.js -->
                </div>
            </section>

            <section id="gallery" class="channel-section">
            </section>

            <section id="training" class="channel-section">
                <!-- Admin button for managing modules -->
                <button id="manage-modules-btn" class="btn btn-primary" style="display: none; margin-bottom: 20px;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    Zarządzaj modułami
                </button>

                <div class="training-layout">
                    <div class="training-sidebar">
                        <h3>Wybierz moduł:</h3>
                        <div id="training-modules-list">
                            <p class="loading-text">Ładowanie modułów...</p>
                        </div>
                    </div>

                    <div class="training-content card">
                        <div id="module-content">
                            <p style="text-align: center; color: #666;">Wybierz moduł z listy po lewej</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- NEW: Sekcja profilu użytkownika -->
            <section id="profile" class="channel-section">
                <div class="card">
                    <h2>Twój profil</h2>
                    <p class="subtitle">Zarządzaj swoimi danymi osobowymi</p>

                    <!-- Upload avatara -->
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-container">
                            <div id="profile-avatar-preview" class="profile-avatar-preview">
                                <div class="avatar-placeholder">?</div>
                            </div>
                            <div class="profile-avatar-actions">
                                <label for="avatar-upload" class="btn btn-outline btn-small">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                                    Zmień zdjęcie
                                </label>
                                <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                                <button type="button" id="remove-avatar-btn" class="btn btn-text btn-small" style="display: none;">Usuń zdjęcie</button>
                            </div>
                        </div>
                    </div>

                    <form id="profile-form">
                        <div class="form-group">
                            <label for="profile-full-name">Imię i nazwisko</label>
                            <input type="text" id="profile-full-name" class="form-input" placeholder="Jan Kowalski" required>
                        </div>

                        <div class="form-group">
                            <label for="profile-email">Adres e-mail</label>
                            <input type="email" id="profile-email" class="form-input" placeholder="jan.kowalski@example.com" disabled>
                            <p class="form-hint">Adres e-mail nie może być zmieniony</p>
                        </div>

                        <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
                    </form>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h3>Zmiana hasła</h3>
                    <p class="subtitle">Ustaw nowe hasło dla swojego konta</p>

                    <form id="change-password-form">
                        <div class="form-group">
                            <label for="new-password">Nowe hasło</label>
                            <input type="password" id="new-password" class="form-input" placeholder="Minimum 6 znaków" required minlength="6">
                        </div>

                        <div class="form-group">
                            <label for="confirm-password">Potwierdź nowe hasło</label>
                            <input type="password" id="confirm-password" class="form-input" placeholder="Powtórz nowe hasło" required minlength="6">
                        </div>

                        <button type="submit" class="btn btn-primary">Zmień hasło</button>
                    </form>
                </div>
            </section>

        </main>
    </div>

    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-column">
                <h3>Lokalizacja</h3>
                <p id="footer-location-address" class="editable-html" data-text-id="footer_location_address">ul. Kaliskiego 57, Lotnisko Warszawa Babice<br>Hangar 4, 01-476 Warszawa</p>
                <div class="map-container">
                    <iframe
    src="https://maps.google.com/maps?q=52.266827,20.838889&t=&z=15&ie=UTF8&iwloc=&output=embed"
    width="100%"
    height="250"
    style="border:0;"
    loading="lazy"
    referrerpolicy="no-referrer-when-downgrade">
</iframe>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© Evair 2025</p>
            <nav class="footer-nav">
                <a href="#" id="open-regulations">Regulamin</a> |
                <a href="#" id="open-privacy">Polityka prywatności</a>
            </nav>
        </div>
    </footer>

    <div id="lightbox" class="modal hidden">
        <div class="modal-content lightbox-content">
            <span class="close-modal" onclick="closeLightbox()">× Zamknij</span>
            <button class="lightbox-nav-btn lightbox-prev" id="lightbox-prev" onclick="changeLightboxImage(-1)" aria-label="Poprzednie zdjęcie">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            <button class="lightbox-nav-btn lightbox-next" id="lightbox-next" onclick="changeLightboxImage(1)" aria-label="Następne zdjęcie">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
            <div id="lightbox-img-placeholder" class="img-placeholder"></div>
            <p id="lightbox-caption"></p>
            <p id="lightbox-date"></p>
        </div>
    </div>

    <div id="regulations-modal" class="modal hidden">
        <div class="modal-card">
            <div class="modal-header">
                <h2>Regulamin Platformy Evair</h2>
                <button class="close-modal-btn" onclick="closeRegulations()">Zamknij ✕</button>
            </div>
            <div class="modal-body-scroll" id="regulations-content">
                <p style="text-align: center; color: #999;">Ładowanie...</p>
            </div>
        </div>
    </div>

    <div id="privacy-modal" class="modal hidden">
        <div class="modal-card">
            <div class="modal-header">
                <h2>Polityka Prywatności</h2>
                <button class="close-modal-btn" onclick="closePrivacyPolicy()">Zamknij ✕</button>
            </div>
            <div class="modal-body-scroll" id="privacy-content">
                <p style="text-align: center; color: #999;">Ładowanie...</p>
            </div>
        </div>
    </div>

    <!-- NEW: Modal logowania i rejestracji -->
    <div id="auth-modal" class="modal">
        <div class="modal-card auth-modal-card">
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Zaloguj się</button>
                <button class="auth-tab" data-tab="register">Zarejestruj się</button>
            </div>

            <!-- Formularz logowania -->
            <div id="login-form-container" class="auth-form-container active">
                <h2>Witaj z powrotem!</h2>
                <p class="subtitle">Zaloguj się, aby kontynuować</p>

                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Adres e-mail</label>
                        <input type="email" id="login-email" class="form-input" placeholder="twoj@email.pl" required>
                    </div>

                    <div class="form-group">
                        <label for="login-password">Hasło</label>
                        <input type="password" id="login-password" class="form-input" placeholder="Twoje hasło" required>
                    </div>

                    <div id="login-error" class="error-message"></div>

                    <button type="submit" class="btn btn-primary btn-block">Zaloguj się</button>
                </form>
            </div>

            <!-- Formularz rejestracji -->
            <div id="register-form-container" class="auth-form-container">
                <h2>Dołącz do nas!</h2>
                <p class="subtitle">Utwórz nowe konto</p>

                <form id="register-form">
                    <div class="form-group">
                        <label for="register-name">Imię i nazwisko</label>
                        <input type="text" id="register-name" class="form-input" placeholder="Jan Kowalski" required>
                    </div>

                    <div class="form-group">
                        <label for="register-email">Adres e-mail</label>
                        <input type="email" id="register-email" class="form-input" placeholder="twoj@email.pl" required>
                    </div>

                    <div class="form-group">
                        <label for="register-password">Hasło</label>
                        <input type="password" id="register-password" class="form-input" placeholder="Minimum 6 znaków" required minlength="6">
                    </div>

                    <div class="form-group">
                        <label for="register-confirm">Potwierdź hasło</label>
                        <input type="password" id="register-confirm" class="form-input" placeholder="Powtórz hasło" required minlength="6">
                    </div>

                    <div id="register-error" class="error-message"></div>

                    <button type="submit" class="btn btn-primary btn-block">Zarejestruj się</button>
                </form>
            </div>
        </div>
    </div>

    <!-- NEW: Modal listy osób, które polubiły post/komentarz -->
    <div id="likes-modal" class="modal hidden">
        <div class="modal-card">
            <div class="modal-header">
                <h2>Osoby, które to lubią</h2>
                <button class="close-modal-btn" onclick="closeLikesModal()">Zamknij ✕</button>
            </div>
            <div class="modal-body-scroll">
                <div id="likes-list"></div>
            </div>
        </div>
    </div>

    <!-- NEW: Popover DM confirmation -->
    <div id="dm-popover" class="dm-popover hidden">
        <div class="dm-popover-content">
            <p id="dm-popover-text">Czy chcesz rozpocząć prywatną rozmowę z <strong id="dm-popover-username"></strong>?</p>
            <div class="dm-popover-buttons">
                <button id="dm-popover-confirm" class="btn btn-primary btn-small">Rozpocznij</button>
                <button id="dm-popover-cancel" class="btn btn-outline btn-small">Anuluj</button>
            </div>
        </div>
    </div>

    <!-- NEW: Modal nowej rozmowy -->
    <div id="new-conversation-modal" class="modal hidden">
        <div class="modal-card">
            <div class="modal-header">
                <h2>Nowa rozmowa</h2>
                <button class="close-modal-btn" onclick="closeNewConversationModal()">Zamknij ✕</button>
            </div>
            <div class="modal-body-scroll">
                <div class="form-group">
                    <label>Wyszukaj osobę</label>
                    <input type="text" id="user-search-input" class="form-input" placeholder="Wpisz imię lub email...">
                </div>
                <div id="user-search-results" class="user-search-results"></div>

                <div id="selected-users-section" style="display: none;">
                    <h4 style="margin-top: 20px;">Wybrane osoby:</h4>
                    <div id="selected-users-list" class="selected-users-list"></div>

                    <div class="form-group" id="group-name-section" style="display: none;">
                        <label for="group-name-input">Nazwa grupy</label>
                        <input type="text" id="group-name-input" class="form-input" placeholder="Np. Zespół projektowy">
                    </div>

                    <button id="start-conversation-btn" class="btn btn-primary btn-block">Rozpocznij rozmowę</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal (Admin Only) -->
    <div id="user-management-modal" class="modal hidden">
        <div class="modal-card user-management-modal">
            <div class="modal-header">
                <h2>Zarządzanie użytkownikami</h2>
                <button class="close-modal-btn" onclick="closeUserManagementModal()">Zamknij ✕</button>
            </div>
            <div class="modal-body-scroll">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Użytkownik</th>
                            <th>Rola</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <!-- Users will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Event Participants Modal (Admin Only) -->
    <div id="event-participants-modal" class="modal hidden">
        <div class="modal-card">
            <div class="modal-header">
                <h2>Lista uczestników</h2>
                <button class="close-modal-btn" onclick="closeEventParticipantsModal()">Zamknij ✕</button>
            </div>
            <div class="modal-body-scroll">
                <div id="event-participants-list">
                    <p class="loading-text">Ładowanie...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Training Modules Management Modal (Admin Only) -->
    <div id="training-modules-modal" class="modal hidden">
        <div class="modal-card" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Zarządzanie modułami szkoleniowymi</h2>
                <button class="close-modal-btn" onclick="closeTrainingModulesModal()">Zamknij ✕</button>
            </div>
            <div class="modal-body-scroll">
                <!-- Add new module button -->
                <button id="add-new-module-btn" class="btn btn-primary" style="margin-bottom: 20px;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Dodaj nowy moduł
                </button>

                <!-- Modules list -->
                <div id="admin-modules-list">
                    <p class="loading-text">Ładowanie...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Training Module Modal (Admin Only) -->
    <div id="edit-module-modal" class="modal hidden">
        <div class="modal-card" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 id="edit-module-title">Edytuj moduł</h2>
                <button class="close-modal-btn" onclick="closeEditModuleModal()">Zamknij ✕</button>
            </div>
            <div class="modal-body-scroll">
                <form id="edit-module-form">
                    <input type="hidden" id="edit-module-id">

                    <div class="form-group">
                        <label for="edit-module-name">Nazwa modułu</label>
                        <input type="text" id="edit-module-name" class="form-input" placeholder="np. Moduł 1: Podstawy" required>
                    </div>

                    <div class="form-group">
                        <label>Treść modułu</label>
                        <div class="rich-text-toolbar">
                            <button type="button" class="toolbar-btn" data-command="bold" title="Pogrubienie">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="italic" title="Kursywa">
                                <em>I</em>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="underline" title="Podkreślenie">
                                <u>U</u>
                            </button>
                            <span class="toolbar-separator">|</span>
                            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h2" title="Nagłówek 2">
                                H2
                            </button>
                            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h3" title="Nagłówek 3">
                                H3
                            </button>
                            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="p" title="Paragraf">
                                P
                            </button>
                            <span class="toolbar-separator">|</span>
                            <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Lista punktowana">
                                • Lista
                            </button>
                            <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Lista numerowana">
                                1. Lista
                            </button>
                            <span class="toolbar-separator">|</span>
                            <button type="button" class="toolbar-btn" data-command="insertHorizontalRule" title="Linia pozioma">
                                ―
                            </button>
                        </div>
                        <div id="edit-module-content" class="rich-text-editor" contenteditable="true">
                            <p>Wpisz treść modułu...</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="edit-module-video">Wideo (opcjonalnie)</label>
                        <input type="file" id="edit-module-video" class="form-input" accept="video/*">
                        <p class="form-hint" id="current-video-info"></p>
                    </div>

                    <div class="form-group">
                        <label for="edit-module-pdf">Dokument PDF (opcjonalnie)</label>
                        <input type="file" id="edit-module-pdf" class="form-input" accept=".pdf">
                        <p class="form-hint" id="current-pdf-info"></p>
                    </div>

                    <div class="form-group">
                        <label for="edit-module-embed">Kod embed (opcjonalnie)</label>
                        <textarea id="edit-module-embed" class="form-input" rows="3" placeholder="Wklej kod iframe lub embed..."></textarea>
                        <p class="form-hint">Możesz osadzić zewnętrzne treści (YouTube, Vimeo, itp.)</p>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="edit-module-active" checked>
                            Moduł aktywny (widoczny dla użytkowników)
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Zapisz moduł</button>
                        <button type="button" class="btn btn-outline" onclick="closeEditModuleModal()">Anuluj</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- CHANGED: Dodanie type="module" dla ES6 imports -->
    <script type="module" src="app.js"></script>
</body>
</html>